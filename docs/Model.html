<!DOCTYPE html>

<html>
<head>
  <title>Model.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="Collection.html">
                  Collection.js
                </a>
              
                
                <a class="source" href="Model.html">
                  Model.js
                </a>
              
                
                <a class="source" href="core.html">
                  core.js
                </a>
              
                
                <a class="source" href="events.html">
                  events.js
                </a>
              
                
                <a class="source" href="extend.html">
                  extend.js
                </a>
              
                
                <a class="source" href="fetch.html">
                  fetch.js
                </a>
              
                
                <a class="source" href="flags.html">
                  flags.js
                </a>
              
                
                <a class="source" href="mixin-methods.html">
                  mixin-methods.js
                </a>
              
                
                <a class="source" href="sync.html">
                  sync.js
                </a>
              
                
                <a class="source" href="utils.html">
                  utils.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>Model.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">import</span> _ <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;lodash&#x27;</span>;
<span class="hljs-keyword">import</span> { urlError, wrapError } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./utils&#x27;</span>;
<span class="hljs-keyword">import</span> extend <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./extend&#x27;</span>;
<span class="hljs-keyword">import</span> { sync } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./sync&#x27;</span>;
<span class="hljs-keyword">import</span> { mixinMethods } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./mixin-methods&#x27;</span>;
<span class="hljs-keyword">import</span> { Events } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./events&#x27;</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h2 id="model">Model</h2>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p><strong>Models</strong> are the basic data object in the framework – frequently
representing a row in a table in a database on your server. A discrete chunk
of data and a bunch of useful, related methods for performing computations
and transformations on that data.</p>

            </div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Create a new model with the specified attributes. A client id (<code>cid</code>)
is automatically generated and assigned for you.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> Model = <span class="hljs-comment">/*#__PURE__*/</span> (<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> Model = <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Model</span> </span>{
    <span class="hljs-keyword">static</span> extend = extend;

    <span class="hljs-keyword">constructor</span>(attributes, options) {
      <span class="hljs-keyword">let</span> attrs = attributes || {};
      options || (options = {});
      <span class="hljs-built_in">this</span>.preinitialize.apply(<span class="hljs-built_in">this</span>, <span class="hljs-built_in">arguments</span>);
      <span class="hljs-built_in">this</span>.cid = _.uniqueId(<span class="hljs-built_in">this</span>.cidPrefix);
      <span class="hljs-built_in">this</span>.attributes = {};
      <span class="hljs-keyword">if</span> (options.collection) <span class="hljs-built_in">this</span>.collection = options.collection;
      <span class="hljs-keyword">if</span> (options.parse) attrs = <span class="hljs-built_in">this</span>.parse(attrs, options) || {};
      <span class="hljs-keyword">const</span> defaults = _.result(<span class="hljs-built_in">this</span>, <span class="hljs-string">&#x27;defaults&#x27;</span>);
      attrs = _.defaults({ ...defaults, ...attrs }, defaults);
      <span class="hljs-built_in">this</span>.set(attrs, options);
      <span class="hljs-built_in">this</span>.changed = {};
      <span class="hljs-built_in">this</span>.initialize.apply(<span class="hljs-built_in">this</span>, <span class="hljs-built_in">arguments</span>);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Return a copy of the model’s <code>attributes</code> object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    toJSON(options) {
      <span class="hljs-keyword">return</span> { ...this.attributes };
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Proxy <code>Backbone.sync</code> by default – but override this if you need
custom syncing semantics for <em>this</em> particular model.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    sync(...args) {
      <span class="hljs-keyword">return</span> sync.apply(<span class="hljs-built_in">this</span>, args);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Get the value of an attribute.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    get(attr) {
      <span class="hljs-keyword">return</span> _.get(<span class="hljs-built_in">this</span>.attributes, [attr]);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Get the HTML-escaped value of an attribute.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-built_in">escape</span>(attr) {
      <span class="hljs-keyword">return</span> _.escape(<span class="hljs-built_in">this</span>.get(attr));
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Returns <code>true</code> if the attribute contains a value that is not null
or undefined.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    has(attr) {
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.get(attr) != <span class="hljs-literal">null</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Special-cased proxy to underscore’s <code>_.matches</code> method.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    matches(attrs) {
      <span class="hljs-keyword">return</span> !!_.iteratee(attrs, <span class="hljs-built_in">this</span>)(<span class="hljs-built_in">this</span>.attributes);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Set a hash of model attributes on the object, firing <code>&quot;change&quot;</code>. This is
the core primitive operation of a model, updating the data and notifying
anyone who needs to know about the change in state. The heart of the beast.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    set(key, val, options) {
      <span class="hljs-keyword">if</span> (key == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Handle both <code>&quot;key&quot;, value</code> and <code>{key: value}</code> -style arguments.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">let</span> attrs;
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> key === <span class="hljs-string">&#x27;object&#x27;</span>) {
        attrs = key;
        options = val;
      } <span class="hljs-keyword">else</span> {
        (attrs = {})[key] = val;
      }

      options || (options = {});</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Run validation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>._validate(attrs, options)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Extract attributes and options.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">const</span> unset = options.unset;
      <span class="hljs-keyword">const</span> silent = options.silent;
      <span class="hljs-keyword">const</span> changes = [];
      <span class="hljs-keyword">const</span> changing = <span class="hljs-built_in">this</span>._changing;
      <span class="hljs-built_in">this</span>._changing = <span class="hljs-literal">true</span>;

      <span class="hljs-keyword">if</span> (!changing) {
        <span class="hljs-built_in">this</span>._previousAttributes = { ...this.attributes };
        <span class="hljs-built_in">this</span>.changed = {};
      }

      <span class="hljs-keyword">const</span> current = <span class="hljs-built_in">this</span>.attributes;
      <span class="hljs-keyword">const</span> changed = <span class="hljs-built_in">this</span>.changed;
      <span class="hljs-keyword">const</span> prev = <span class="hljs-built_in">this</span>._previousAttributes;</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>For each <code>set</code> attribute, update or delete the current value.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> attr <span class="hljs-keyword">in</span> attrs) {
        val = attrs[attr];
        <span class="hljs-keyword">if</span> (!_.isEqual(current[attr], val)) changes.push(attr);
        <span class="hljs-keyword">if</span> (!_.isEqual(prev[attr], val)) {
          changed[attr] = val;
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">delete</span> changed[attr];
        }
        unset ? <span class="hljs-keyword">delete</span> current[attr] : (current[attr] = val);
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Update the <code>id</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.idAttribute <span class="hljs-keyword">in</span> attrs) <span class="hljs-built_in">this</span>.id = <span class="hljs-built_in">this</span>.get(<span class="hljs-built_in">this</span>.idAttribute);</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Trigger all relevant attribute changes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (!silent) {
        <span class="hljs-keyword">if</span> (changes.length) <span class="hljs-built_in">this</span>._pending = options;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; changes.length; i++) {
          <span class="hljs-built_in">this</span>.trigger(<span class="hljs-string">&#x27;change:&#x27;</span> + changes[i], <span class="hljs-built_in">this</span>, current[changes[i]], options);
        }
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>You might be wondering why there’s a <code>while</code> loop here. Changes can
be recursively nested within <code>&quot;change&quot;</code> events.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (changing) <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
      <span class="hljs-keyword">if</span> (!silent) {
        <span class="hljs-keyword">while</span> (<span class="hljs-built_in">this</span>._pending) {
          options = <span class="hljs-built_in">this</span>._pending;
          <span class="hljs-built_in">this</span>._pending = <span class="hljs-literal">false</span>;
          <span class="hljs-built_in">this</span>.trigger(<span class="hljs-string">&#x27;change&#x27;</span>, <span class="hljs-built_in">this</span>, options);
        }
      }
      <span class="hljs-built_in">this</span>._pending = <span class="hljs-literal">false</span>;
      <span class="hljs-built_in">this</span>._changing = <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Remove an attribute from the model, firing <code>&quot;change&quot;</code>. <code>unset</code> is a noop
if the attribute doesn’t exist.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    unset(attr, options) {
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.set(attr, <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>, { ...options, <span class="hljs-attr">unset</span>: <span class="hljs-literal">true</span> });
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Clear all attributes on the model, firing <code>&quot;change&quot;</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    clear(options) {
      <span class="hljs-keyword">const</span> attrs = {};
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">in</span> <span class="hljs-built_in">this</span>.attributes) attrs[key] = <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.set(attrs, { ...options, <span class="hljs-attr">unset</span>: <span class="hljs-literal">true</span> });
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Determine if the model has changed since the last <code>&quot;change&quot;</code> event.
If you specify an attribute name, determine if that attribute has changed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    hasChanged(attr) {
      <span class="hljs-keyword">if</span> (attr == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> !_.isEmpty(<span class="hljs-built_in">this</span>.changed);
      <span class="hljs-keyword">return</span> _.has(<span class="hljs-built_in">this</span>.changed, [attr]);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Return an object containing all the attributes that have changed, or
false if there are no changed attributes. Useful for determining what
parts of a view need to be updated and/or what attributes need to be
persisted to the server. Unset attributes will be set to undefined.
You can also pass an attributes object to diff against the model,
determining if there <em>would be</em> a change.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    changedAttributes(diff) {
      <span class="hljs-keyword">if</span> (!diff) <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.hasChanged() ? { ...this.changed } : <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">const</span> old = <span class="hljs-built_in">this</span>._changing ? <span class="hljs-built_in">this</span>._previousAttributes : <span class="hljs-built_in">this</span>.attributes;
      <span class="hljs-keyword">const</span> changed = {};
      <span class="hljs-keyword">let</span> hasChanged;
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> attr <span class="hljs-keyword">in</span> diff) {
        <span class="hljs-keyword">const</span> val = diff[attr];
        <span class="hljs-keyword">if</span> (_.isEqual(old[attr], val)) <span class="hljs-keyword">continue</span>;
        changed[attr] = val;
        hasChanged = <span class="hljs-literal">true</span>;
      }
      <span class="hljs-keyword">return</span> hasChanged ? changed : <span class="hljs-literal">false</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Get the previous value of an attribute, recorded at the time the last
<code>&quot;change&quot;</code> event was fired.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    previous(attr) {
      <span class="hljs-keyword">if</span> (attr == <span class="hljs-literal">null</span> || !<span class="hljs-built_in">this</span>._previousAttributes) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>._previousAttributes[attr];
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Get all of the attributes of the model at the time of the previous
<code>&quot;change&quot;</code> event.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    previousAttributes() {
      <span class="hljs-keyword">return</span> { ...this._previousAttributes };
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Fetch the model from the server, merging the response with the model’s
local attributes. Any changed attributes will trigger a “change” event.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    fetch(options) {
      options = { <span class="hljs-attr">parse</span>: <span class="hljs-literal">true</span>, ...options };
      <span class="hljs-keyword">const</span> model = <span class="hljs-built_in">this</span>;
      <span class="hljs-keyword">const</span> success = options.success;
      options.success = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">resp</span>) </span>{
        <span class="hljs-keyword">const</span> serverAttrs = options.parse ? model.parse(resp, options) : resp;
        <span class="hljs-keyword">if</span> (!model.set(serverAttrs, options)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">if</span> (success) success.call(options.context, model, resp, options);
        model.trigger(<span class="hljs-string">&#x27;sync&#x27;</span>, model, resp, options);
      };
      wrapError(<span class="hljs-built_in">this</span>, options);
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.sync(<span class="hljs-string">&#x27;read&#x27;</span>, <span class="hljs-built_in">this</span>, options);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Set a hash of model attributes, and sync the model to the server.
If the server returns an attributes hash that differs, the model’s
state will be <code>set</code> again.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    save(key, val, options) {</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Handle both <code>&quot;key&quot;, value</code> and <code>{key: value}</code> -style arguments.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">let</span> attrs;
      <span class="hljs-keyword">if</span> (key == <span class="hljs-literal">null</span> || <span class="hljs-keyword">typeof</span> key === <span class="hljs-string">&#x27;object&#x27;</span>) {
        attrs = key;
        options = val;
      } <span class="hljs-keyword">else</span> {
        (attrs = {})[key] = val;
      }

      options = { <span class="hljs-attr">validate</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">parse</span>: <span class="hljs-literal">true</span>, ...options };
      <span class="hljs-keyword">const</span> wait = options.wait;</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>If we’re not waiting and attributes exist, save acts as
<code>set(attr).save(null, opts)</code> with validation. Otherwise, check if
the model will be valid when the attributes, if any, are set.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (attrs &amp;&amp; !wait) {
        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>.set(attrs, options)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>._validate(attrs, options)) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>After a successful server-side save, the client is (optionally)
updated with the server-side state.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">const</span> model = <span class="hljs-built_in">this</span>;
      <span class="hljs-keyword">const</span> success = options.success;
      <span class="hljs-keyword">const</span> attributes = <span class="hljs-built_in">this</span>.attributes;
      options.success = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">resp</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Ensure attributes are restored during synchronous saves.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        model.attributes = attributes;
        <span class="hljs-keyword">let</span> serverAttrs = options.parse ? model.parse(resp, options) : resp;
        <span class="hljs-keyword">if</span> (wait) serverAttrs = { ...attrs, ...serverAttrs };
        <span class="hljs-keyword">if</span> (serverAttrs &amp;&amp; !model.set(serverAttrs, options)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">if</span> (success) success.call(options.context, model, resp, options);
        model.trigger(<span class="hljs-string">&#x27;sync&#x27;</span>, model, resp, options);
      };
      wrapError(<span class="hljs-built_in">this</span>, options);</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Set temporary attributes if <code>{wait: true}</code> to properly find new ids.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (attrs &amp;&amp; wait) <span class="hljs-built_in">this</span>.attributes = { ...attributes, ...attrs };

      <span class="hljs-keyword">const</span> method = <span class="hljs-built_in">this</span>.isNew() ? <span class="hljs-string">&#x27;create&#x27;</span> : options.patch ? <span class="hljs-string">&#x27;patch&#x27;</span> : <span class="hljs-string">&#x27;update&#x27;</span>;
      <span class="hljs-keyword">if</span> (method === <span class="hljs-string">&#x27;patch&#x27;</span> &amp;&amp; !options.attrs) options.attrs = attrs;
      <span class="hljs-keyword">const</span> xhr = <span class="hljs-built_in">this</span>.sync(method, <span class="hljs-built_in">this</span>, options);</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Restore attributes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-built_in">this</span>.attributes = attributes;

      <span class="hljs-keyword">return</span> xhr;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Destroy this model on the server if it was already persisted.
Optimistically removes the model from its collection, if it has one.
If <code>wait: true</code> is passed, waits for the server to respond before removal.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    destroy(options) {
      options = { ...options };
      <span class="hljs-keyword">const</span> model = <span class="hljs-built_in">this</span>;
      <span class="hljs-keyword">const</span> success = options.success;
      <span class="hljs-keyword">const</span> wait = options.wait;

      <span class="hljs-keyword">const</span> destroy = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        model.stopListening();
        model.trigger(<span class="hljs-string">&#x27;destroy&#x27;</span>, model, model.collection, options);
      };

      options.success = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">resp</span>) </span>{
        <span class="hljs-keyword">if</span> (wait) destroy();
        <span class="hljs-keyword">if</span> (success) success.call(options.context, model, resp, options);
        <span class="hljs-keyword">if</span> (!model.isNew()) model.trigger(<span class="hljs-string">&#x27;sync&#x27;</span>, model, resp, options);
      };

      <span class="hljs-keyword">let</span> xhr = <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.isNew()) {
        _.defer(options.success);
      } <span class="hljs-keyword">else</span> {
        wrapError(<span class="hljs-built_in">this</span>, options);
        xhr = <span class="hljs-built_in">this</span>.sync(<span class="hljs-string">&#x27;delete&#x27;</span>, <span class="hljs-built_in">this</span>, options);
      }
      <span class="hljs-keyword">if</span> (!wait) destroy();
      <span class="hljs-keyword">return</span> xhr;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Default URL for the model’s representation on the server – if you’re using
the restful methods, override this to change the endpoint that will be
called.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    url() {
      <span class="hljs-keyword">const</span> base = _.result(<span class="hljs-built_in">this</span>, <span class="hljs-string">&#x27;urlRoot&#x27;</span>) || _.result(<span class="hljs-built_in">this</span>.collection, <span class="hljs-string">&#x27;url&#x27;</span>) || urlError();
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.isNew()) <span class="hljs-keyword">return</span> base;
      <span class="hljs-keyword">const</span> id = <span class="hljs-built_in">this</span>.get(<span class="hljs-built_in">this</span>.idAttribute);
      <span class="hljs-keyword">return</span> base.replace(<span class="hljs-regexp">/[^\/]$/</span>, <span class="hljs-string">&#x27;$&amp;/&#x27;</span>) + <span class="hljs-built_in">encodeURIComponent</span>(id);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p><strong>parse</strong> converts a response into the hash of attributes to be <code>set</code> on
the model. The default implementation is just to pass the response along.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    parse(resp, options) {
      <span class="hljs-keyword">return</span> resp;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Create a new model with identical attributes to this one.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    clone() {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">this</span>.constructor(<span class="hljs-built_in">this</span>.attributes);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>A model is new if it has never been saved to the server, and lacks an id.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    isNew() {
      <span class="hljs-keyword">return</span> !<span class="hljs-built_in">this</span>.has(<span class="hljs-built_in">this</span>.idAttribute);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Check if the model is currently in a valid state.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    isValid(options) {
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>._validate({}, { ...options, <span class="hljs-attr">validate</span>: <span class="hljs-literal">true</span> });
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Run validation against the next complete set of model attributes,
returning <code>true</code> if all is well. Otherwise, fire an <code>&quot;invalid&quot;</code> event.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _validate(attrs, options) {
      <span class="hljs-keyword">if</span> (!options.validate || !<span class="hljs-built_in">this</span>.validate) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
      attrs = { ...this.attributes, attrs };
      <span class="hljs-keyword">const</span> error = (<span class="hljs-built_in">this</span>.validationError = <span class="hljs-built_in">this</span>.validate(attrs, options) || <span class="hljs-literal">null</span>);
      <span class="hljs-keyword">if</span> (!error) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
      <span class="hljs-built_in">this</span>.trigger(<span class="hljs-string">&#x27;invalid&#x27;</span>, <span class="hljs-built_in">this</span>, error, { ...options, <span class="hljs-attr">validationError</span>: error });
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
  };

  <span class="hljs-keyword">const</span> proto = Model.prototype;
  <span class="hljs-built_in">Object</span>.assign(proto, Events);</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>A hash of attributes whose current and previous value differ.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  proto.changed = <span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>The value returned during the last failed validation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  proto.validationError = <span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>The default name for the JSON <code>id</code> attribute is <code>&quot;id&quot;</code>. MongoDB and CouchDB
users may want to set this to <code>&quot;_id&quot;</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  proto.idAttribute = <span class="hljs-string">&#x27;id&#x27;</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>The prefix is used to create the client id which is used to identify models
locally. You may want to override this if you’re experiencing name clashes
with model ids.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  proto.cidPrefix = <span class="hljs-string">&#x27;c&#x27;</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>preinitialize is an empty function by default. You can override it with a
function or object.  preinitialize will run before any instantiation logic
is run in the Model.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  proto.preinitialize = _.noop;</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>Initialize is an empty function by default. Override it with your own
initialization logic.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  proto.initialize = _.noop;</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>Lodash methods that we want to implement on the Model, mapped to the number
of arguments they take.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  mixinMethods(
    Model,
    [
      [<span class="hljs-string">&#x27;chain&#x27;</span>, _.chain, <span class="hljs-number">1</span>],
      [<span class="hljs-string">&#x27;entries&#x27;</span>, _.entries, <span class="hljs-number">1</span>],
      [<span class="hljs-string">&#x27;invert&#x27;</span>, _.invert, <span class="hljs-number">1</span>],
      [<span class="hljs-string">&#x27;isEmpty&#x27;</span>, _.isEmpty, <span class="hljs-number">1</span>],
      [<span class="hljs-string">&#x27;keys&#x27;</span>, _.keys, <span class="hljs-number">1</span>],
      [<span class="hljs-string">&#x27;omit&#x27;</span>, _.omit, <span class="hljs-number">0</span>],
      [<span class="hljs-string">&#x27;omitBy&#x27;</span>, _.omitBy, <span class="hljs-number">1</span>],
      [<span class="hljs-string">&#x27;pick&#x27;</span>, _.pick, <span class="hljs-number">0</span>],
      [<span class="hljs-string">&#x27;pickBy&#x27;</span>, _.pickBy, <span class="hljs-number">1</span>],
      [<span class="hljs-string">&#x27;values&#x27;</span>, _.values, <span class="hljs-number">1</span>],
    ],
    <span class="hljs-string">&#x27;attributes&#x27;</span>
  );</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Translated, roughly, from underscore:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  proto.pairs = proto.entries;

  <span class="hljs-keyword">return</span> Model;
})();</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
