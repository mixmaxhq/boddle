<!DOCTYPE html>

<html>
<head>
  <title>Collection.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="Collection.html">
                  Collection.js
                </a>
              
                
                <a class="source" href="Model.html">
                  Model.js
                </a>
              
                
                <a class="source" href="core.html">
                  core.js
                </a>
              
                
                <a class="source" href="events.html">
                  events.js
                </a>
              
                
                <a class="source" href="extend.html">
                  extend.js
                </a>
              
                
                <a class="source" href="fetch.html">
                  fetch.js
                </a>
              
                
                <a class="source" href="flags.html">
                  flags.js
                </a>
              
                
                <a class="source" href="mixin-methods.html">
                  mixin-methods.js
                </a>
              
                
                <a class="source" href="sync.html">
                  sync.js
                </a>
              
                
                <a class="source" href="utils.html">
                  utils.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>Collection.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">import</span> { slice, splice, wrapError } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./utils&#x27;</span>;
<span class="hljs-keyword">import</span> extend <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./extend&#x27;</span>;
<span class="hljs-keyword">import</span> { Model } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./Model&#x27;</span>;
<span class="hljs-keyword">import</span> { sync } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./sync&#x27;</span>;
<span class="hljs-keyword">import</span> _ <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;lodash&#x27;</span>;
<span class="hljs-keyword">import</span> { mixinMethods } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./mixin-methods&#x27;</span>;
<span class="hljs-keyword">import</span> { Events } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./events&#x27;</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h2 id="collection">Collection</h2>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Defining an @@iterator method implements JavaScript’s Iterable protocol.
In modern ES2015 browsers, this value is found at Symbol.iterator.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/* global Symbol */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> $$iterator = <span class="hljs-keyword">typeof</span> <span class="hljs-built_in">Symbol</span> === <span class="hljs-string">&#x27;function&#x27;</span> &amp;&amp; <span class="hljs-built_in">Symbol</span>.iterator;</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>If models tend to represent a single row of data, a Collection is more
analogous to a table full of data … or a small slice or page of that table,
or a collection of rows that belong together for a particular reason
– all of the messages in this particular folder, all of the documents
belonging to this particular author, and so on. Collections maintain indexes
of their models, both in order, and for lookup by <code>id</code>.</p>

            </div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Default options for <code>Collection#set</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> setOptions = { <span class="hljs-attr">add</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">remove</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">merge</span>: <span class="hljs-literal">true</span> };
<span class="hljs-keyword">const</span> addOptions = { <span class="hljs-attr">add</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">remove</span>: <span class="hljs-literal">false</span> };</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Create a new <strong>Collection</strong>, perhaps to contain a specific type of <code>model</code>.
If a <code>comparator</code> is specified, the Collection will maintain
its models in sort order, as they’re added and removed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> Collection = <span class="hljs-comment">/*#__PURE__*/</span> (<span class="hljs-function">() =&gt;</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>eslint-disable-next-line no-shadow</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">const</span> Collection = <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Collection</span> </span>{
    <span class="hljs-keyword">static</span> extend = extend;

    <span class="hljs-keyword">constructor</span>(models, options = {}) {
      <span class="hljs-built_in">this</span>.preinitialize.apply(<span class="hljs-built_in">this</span>, <span class="hljs-built_in">arguments</span>);
      <span class="hljs-keyword">if</span> (options.model) <span class="hljs-built_in">this</span>.model = options.model;
      <span class="hljs-keyword">if</span> (options.comparator !== <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>) <span class="hljs-built_in">this</span>.comparator = options.comparator;
      <span class="hljs-built_in">this</span>._reset();
      <span class="hljs-built_in">this</span>.initialize.apply(<span class="hljs-built_in">this</span>, <span class="hljs-built_in">arguments</span>);
      <span class="hljs-keyword">if</span> (models) <span class="hljs-built_in">this</span>.reset(models, { <span class="hljs-attr">silent</span>: <span class="hljs-literal">true</span>, ...options });
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>The JSON representation of a Collection is an array of the
models’ attributes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    toJSON(options) {
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.map(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">model</span>) </span>{
        <span class="hljs-keyword">return</span> model.toJSON(options);
      });
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Proxy <code>sync</code> by default.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    sync(...args) {
      <span class="hljs-keyword">return</span> sync.apply(<span class="hljs-built_in">this</span>, args);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Add a model, or list of models to the set. <code>models</code> may be Models or raw
JavaScript objects to be converted to Models, or any combination of the
two.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    add(models, options) {
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.set(models, { <span class="hljs-attr">merge</span>: <span class="hljs-literal">false</span>, ...options, ...addOptions });
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Remove a model, or a list of models from the set.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    remove(models, options) {
      options = { ...options };
      <span class="hljs-keyword">const</span> singular = !<span class="hljs-built_in">Array</span>.isArray(models);
      models = singular ? [models] : models.slice();
      <span class="hljs-keyword">const</span> removed = <span class="hljs-built_in">this</span>._removeModels(models, options);
      <span class="hljs-keyword">if</span> (!options.silent &amp;&amp; removed.length) {
        options.changes = { <span class="hljs-attr">added</span>: [], <span class="hljs-attr">merged</span>: [], <span class="hljs-attr">removed</span>: removed };
        <span class="hljs-built_in">this</span>.trigger(<span class="hljs-string">&#x27;update&#x27;</span>, <span class="hljs-built_in">this</span>, options);
      }
      <span class="hljs-keyword">return</span> singular ? removed[<span class="hljs-number">0</span>] : removed;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Update a collection by <code>set</code>-ing a new list of models, adding new ones,
removing models that are no longer present, and merging models that
already exist in the collection, as necessary. Similar to <strong>Model#set</strong>,
the core operation for updating the data contained by the collection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    set(models, options) {
      <span class="hljs-keyword">if</span> (models == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span>;

      options = { ...setOptions, ...options };
      <span class="hljs-keyword">if</span> (options.parse &amp;&amp; !<span class="hljs-built_in">this</span>._isModel(models)) {
        models = <span class="hljs-built_in">this</span>.parse(models, options) || [];
      }

      <span class="hljs-keyword">const</span> singular = !<span class="hljs-built_in">Array</span>.isArray(models);
      models = singular ? [models] : models.slice();

      <span class="hljs-keyword">let</span> at = options.at;
      <span class="hljs-keyword">if</span> (at != <span class="hljs-literal">null</span>) at = +at;
      <span class="hljs-keyword">if</span> (at &gt; <span class="hljs-built_in">this</span>.length) at = <span class="hljs-built_in">this</span>.length;
      <span class="hljs-keyword">if</span> (at &lt; <span class="hljs-number">0</span>) at += <span class="hljs-built_in">this</span>.length + <span class="hljs-number">1</span>;

      <span class="hljs-keyword">const</span> set = [];
      <span class="hljs-keyword">const</span> toAdd = [];
      <span class="hljs-keyword">const</span> toMerge = [];
      <span class="hljs-keyword">const</span> toRemove = [];
      <span class="hljs-keyword">const</span> modelMap = {};

      <span class="hljs-keyword">const</span> add = options.add;
      <span class="hljs-keyword">const</span> merge = options.merge;
      <span class="hljs-keyword">const</span> remove = options.remove;

      <span class="hljs-keyword">let</span> sort = <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">const</span> sortable = <span class="hljs-built_in">this</span>.comparator &amp;&amp; at == <span class="hljs-literal">null</span> &amp;&amp; options.sort !== <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">const</span> sortAttr = <span class="hljs-keyword">typeof</span> <span class="hljs-built_in">this</span>.comparator === <span class="hljs-string">&#x27;string&#x27;</span> ? <span class="hljs-built_in">this</span>.comparator : <span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Turn bare objects into model references, and prevent invalid models
from being added.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">let</span> model, i;
      <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; models.length; i++) {
        model = models[i];</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>If a duplicate is found, prevent it from being added and
optionally merge it into the existing model.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">const</span> existing = <span class="hljs-built_in">this</span>.get(model);
        <span class="hljs-keyword">if</span> (existing) {
          <span class="hljs-keyword">if</span> (merge &amp;&amp; model !== existing) {
            <span class="hljs-keyword">let</span> attrs = <span class="hljs-built_in">this</span>._isModel(model) ? model.attributes : model;
            <span class="hljs-keyword">if</span> (options.parse) attrs = existing.parse(attrs, options);
            existing.set(attrs, options);
            toMerge.push(existing);
            <span class="hljs-keyword">if</span> (sortable &amp;&amp; !sort) sort = existing.hasChanged(sortAttr);
          }
          <span class="hljs-keyword">if</span> (!modelMap[existing.cid]) {
            modelMap[existing.cid] = <span class="hljs-literal">true</span>;
            set.push(existing);
          }
          models[i] = existing;</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>If this is a new, valid model, push it to the <code>toAdd</code> list.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (add) {
          model = models[i] = <span class="hljs-built_in">this</span>._prepareModel(model, options);
          <span class="hljs-keyword">if</span> (model) {
            toAdd.push(model);
            <span class="hljs-built_in">this</span>._addReference(model, options);
            modelMap[model.cid] = <span class="hljs-literal">true</span>;
            set.push(model);
          }
        }
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Remove stale models.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (remove) {
        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">this</span>.length; i++) {
          model = <span class="hljs-built_in">this</span>.models[i];
          <span class="hljs-keyword">if</span> (!modelMap[model.cid]) toRemove.push(model);
        }
        <span class="hljs-keyword">if</span> (toRemove.length) <span class="hljs-built_in">this</span>._removeModels(toRemove, options);
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>See if sorting is needed, update <code>length</code> and splice in new models.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">let</span> orderChanged = <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">const</span> replace = !sortable &amp;&amp; add &amp;&amp; remove;
      <span class="hljs-keyword">if</span> (set.length &amp;&amp; replace) {
        orderChanged =
          <span class="hljs-built_in">this</span>.length !== set.length || _.some(<span class="hljs-built_in">this</span>.models, <span class="hljs-function">(<span class="hljs-params">m, index</span>) =&gt;</span> m !== set[index]);
        <span class="hljs-built_in">this</span>.models.length = <span class="hljs-number">0</span>;
        splice(<span class="hljs-built_in">this</span>.models, set, <span class="hljs-number">0</span>);
        <span class="hljs-built_in">this</span>.length = <span class="hljs-built_in">this</span>.models.length;
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (toAdd.length) {
        <span class="hljs-keyword">if</span> (sortable) sort = <span class="hljs-literal">true</span>;
        splice(<span class="hljs-built_in">this</span>.models, toAdd, at == <span class="hljs-literal">null</span> ? <span class="hljs-built_in">this</span>.length : at);
        <span class="hljs-built_in">this</span>.length = <span class="hljs-built_in">this</span>.models.length;
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Silently sort the collection if appropriate.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (sort) <span class="hljs-built_in">this</span>.sort({ <span class="hljs-attr">silent</span>: <span class="hljs-literal">true</span> });</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Unless silenced, it’s time to fire all appropriate add/sort/update events.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (!options.silent) {
        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; toAdd.length; i++) {
          <span class="hljs-keyword">if</span> (at != <span class="hljs-literal">null</span>) options.index = at + i;
          model = toAdd[i];
          model.trigger(<span class="hljs-string">&#x27;add&#x27;</span>, model, <span class="hljs-built_in">this</span>, options);
        }
        <span class="hljs-keyword">if</span> (sort || orderChanged) <span class="hljs-built_in">this</span>.trigger(<span class="hljs-string">&#x27;sort&#x27;</span>, <span class="hljs-built_in">this</span>, options);
        <span class="hljs-keyword">if</span> (toAdd.length || toRemove.length || toMerge.length) {
          options.changes = {
            <span class="hljs-attr">added</span>: toAdd,
            <span class="hljs-attr">removed</span>: toRemove,
            <span class="hljs-attr">merged</span>: toMerge,
          };
          <span class="hljs-built_in">this</span>.trigger(<span class="hljs-string">&#x27;update&#x27;</span>, <span class="hljs-built_in">this</span>, options);
        }
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Return the added (or merged) model (or models).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">return</span> singular ? models[<span class="hljs-number">0</span>] : models;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>When you have more items than you want to add or remove individually,
you can reset the entire set with a new list of models, without firing
any granular <code>add</code> or <code>remove</code> events. Fires <code>reset</code> when finished.
Useful for bulk operations and optimizations.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    reset(models, options) {
      options = { ...options };
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">this</span>.models.length; i++) {
        <span class="hljs-built_in">this</span>._removeReference(<span class="hljs-built_in">this</span>.models[i], options);
      }
      options.previousModels = <span class="hljs-built_in">this</span>.models;
      <span class="hljs-built_in">this</span>._reset();
      models = <span class="hljs-built_in">this</span>.add(models, { <span class="hljs-attr">silent</span>: <span class="hljs-literal">true</span>, ...options });
      <span class="hljs-keyword">if</span> (!options.silent) <span class="hljs-built_in">this</span>.trigger(<span class="hljs-string">&#x27;reset&#x27;</span>, <span class="hljs-built_in">this</span>, options);
      <span class="hljs-keyword">return</span> models;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Add a model to the end of the collection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    push(model, options) {
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.add(model, { <span class="hljs-attr">at</span>: <span class="hljs-built_in">this</span>.length, ...options });
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Remove a model from the end of the collection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    pop(options) {
      <span class="hljs-keyword">const</span> model = <span class="hljs-built_in">this</span>.at(<span class="hljs-built_in">this</span>.length - <span class="hljs-number">1</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.remove(model, options);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Add a model to the beginning of the collection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    unshift(model, options) {
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.add(model, { <span class="hljs-attr">at</span>: <span class="hljs-number">0</span>, ...options });
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Remove a model from the beginning of the collection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    shift(options) {
      <span class="hljs-keyword">const</span> model = <span class="hljs-built_in">this</span>.at(<span class="hljs-number">0</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.remove(model, options);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Slice out a sub-array of models from the collection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    slice(...args) {
      <span class="hljs-keyword">return</span> slice.apply(<span class="hljs-built_in">this</span>.models, args);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Get a model from the set by id, cid, model object with id or cid
properties, or an attributes object that is transformed through modelId.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    get(obj) {
      <span class="hljs-keyword">if</span> (obj == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;
      <span class="hljs-keyword">return</span> (
        <span class="hljs-built_in">this</span>._byId[obj] ||
        <span class="hljs-built_in">this</span>._byId[<span class="hljs-built_in">this</span>.modelId(<span class="hljs-built_in">this</span>._isModel(obj) ? obj.attributes : obj, obj.idAttribute)] ||
        (obj.cid &amp;&amp; <span class="hljs-built_in">this</span>._byId[obj.cid])
      );
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Returns <code>true</code> if the model is in the collection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    has(obj) {
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.get(obj) != <span class="hljs-literal">null</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Get the model at the given index.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    at(index) {
      <span class="hljs-keyword">if</span> (index &lt; <span class="hljs-number">0</span>) index += <span class="hljs-built_in">this</span>.length;
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.models[index];
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Return models with matching attributes. Useful for simple cases of
<code>filter</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    where(attrs, first) {
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>[first ? <span class="hljs-string">&#x27;find&#x27;</span> : <span class="hljs-string">&#x27;filter&#x27;</span>](attrs);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Return the first model with matching attributes. Useful for simple cases
of <code>find</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    findWhere(attrs) {
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.where(attrs, <span class="hljs-literal">true</span>);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Force the collection to re-sort itself. You don’t need to call this under
normal circumstances, as the set will maintain sort order as each item
is added.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    sort(options = {}) {
      <span class="hljs-keyword">let</span> comparator = <span class="hljs-built_in">this</span>.comparator;
      <span class="hljs-keyword">if</span> (!comparator) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&#x27;Cannot sort a set without a comparator&#x27;</span>);

      <span class="hljs-keyword">const</span> length = comparator.length;
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> comparator === <span class="hljs-string">&#x27;function&#x27;</span>) comparator = comparator.bind(<span class="hljs-built_in">this</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Run sort based on type of <code>comparator</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (length === <span class="hljs-number">1</span> || <span class="hljs-keyword">typeof</span> comparator === <span class="hljs-string">&#x27;string&#x27;</span>) {
        <span class="hljs-built_in">this</span>.models = <span class="hljs-built_in">this</span>.sortBy(comparator);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-built_in">this</span>.models.sort(comparator);
      }
      <span class="hljs-keyword">if</span> (!options.silent) <span class="hljs-built_in">this</span>.trigger(<span class="hljs-string">&#x27;sort&#x27;</span>, <span class="hljs-built_in">this</span>, options);
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Pluck an attribute from each model in the collection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    pluck(attr) {
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.map(attr + <span class="hljs-string">&#x27;&#x27;</span>);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Fetch the default set of models for this collection, resetting the
collection when they arrive. If <code>reset: true</code> is passed, the response
data will be passed through the <code>reset</code> method instead of <code>set</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    fetch(options) {
      options = { <span class="hljs-attr">parse</span>: <span class="hljs-literal">true</span>, ...options };
      <span class="hljs-keyword">const</span> success = options.success;
      <span class="hljs-keyword">const</span> collection = <span class="hljs-built_in">this</span>;
      options.success = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">resp</span>) </span>{
        <span class="hljs-keyword">const</span> method = options.reset ? <span class="hljs-string">&#x27;reset&#x27;</span> : <span class="hljs-string">&#x27;set&#x27;</span>;
        collection[method](resp, options);
        <span class="hljs-keyword">if</span> (success) success.call(options.context, collection, resp, options);
        collection.trigger(<span class="hljs-string">&#x27;sync&#x27;</span>, collection, resp, options);
      };
      wrapError(<span class="hljs-built_in">this</span>, options);
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.sync(<span class="hljs-string">&#x27;read&#x27;</span>, <span class="hljs-built_in">this</span>, options);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Create a new instance of a model in this collection. Add the model to the
collection immediately, unless <code>wait: true</code> is passed, in which case we
wait for the server to agree.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    create(model, options) {
      options = { ...options };
      <span class="hljs-keyword">const</span> wait = options.wait;
      model = <span class="hljs-built_in">this</span>._prepareModel(model, options);
      <span class="hljs-keyword">if</span> (!model) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">if</span> (!wait) <span class="hljs-built_in">this</span>.add(model, options);
      <span class="hljs-keyword">const</span> collection = <span class="hljs-built_in">this</span>;
      <span class="hljs-keyword">const</span> success = options.success;
      options.success = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">m, resp, callbackOpts</span>) </span>{
        <span class="hljs-keyword">if</span> (wait) collection.add(m, callbackOpts);
        <span class="hljs-keyword">if</span> (success) success.call(callbackOpts.context, m, resp, callbackOpts);
      };
      model.save(<span class="hljs-literal">null</span>, options);
      <span class="hljs-keyword">return</span> model;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p><strong>parse</strong> converts a response into a list of models to be added to the
collection. The default implementation is just to pass it through.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    parse(resp, options) {
      <span class="hljs-keyword">return</span> resp;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Create a new collection with an identical list of models as this one.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    clone() {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">this</span>.constructor(<span class="hljs-built_in">this</span>.models, {
        <span class="hljs-attr">model</span>: <span class="hljs-built_in">this</span>.model,
        <span class="hljs-attr">comparator</span>: <span class="hljs-built_in">this</span>.comparator,
      });
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Define how to uniquely identify models in the collection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    modelId(attrs, idAttribute) {
      <span class="hljs-keyword">return</span> attrs[idAttribute || <span class="hljs-built_in">this</span>.model.prototype.idAttribute || <span class="hljs-string">&#x27;id&#x27;</span>];
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Get an iterator of all models in this collection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    values() {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CollectionIterator(<span class="hljs-built_in">this</span>, ITERATOR_VALUES);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>Get an iterator of all model IDs in this collection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    keys() {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CollectionIterator(<span class="hljs-built_in">this</span>, ITERATOR_KEYS);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Get an iterator of all [ID, model] tuples in this collection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    entries() {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CollectionIterator(<span class="hljs-built_in">this</span>, ITERATOR_KEYSVALUES);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Private method to reset all internal state. Called when the collection
is first initialized or reset.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _reset() {
      <span class="hljs-built_in">this</span>.length = <span class="hljs-number">0</span>;
      <span class="hljs-built_in">this</span>.models = [];
      <span class="hljs-built_in">this</span>._byId = {};
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Prepare a hash of attributes (or other model) to be added to this
collection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _prepareModel(attrs, options) {
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>._isModel(attrs)) {
        <span class="hljs-keyword">if</span> (!attrs.collection) attrs.collection = <span class="hljs-built_in">this</span>;
        <span class="hljs-keyword">return</span> attrs;
      }
      options = { ...options, <span class="hljs-attr">collection</span>: <span class="hljs-built_in">this</span> };
      <span class="hljs-keyword">const</span> model = <span class="hljs-keyword">new</span> <span class="hljs-built_in">this</span>.model(attrs, options);
      <span class="hljs-keyword">if</span> (!model.validationError) <span class="hljs-keyword">return</span> model;
      <span class="hljs-built_in">this</span>.trigger(<span class="hljs-string">&#x27;invalid&#x27;</span>, <span class="hljs-built_in">this</span>, model.validationError, options);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>Internal method called by both remove and set.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _removeModels(models, options) {
      <span class="hljs-keyword">const</span> removed = [];
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; models.length; i++) {
        <span class="hljs-keyword">const</span> model = <span class="hljs-built_in">this</span>.get(models[i]);
        <span class="hljs-keyword">if</span> (!model) <span class="hljs-keyword">continue</span>;

        <span class="hljs-keyword">const</span> index = <span class="hljs-built_in">this</span>.indexOf(model);
        <span class="hljs-built_in">this</span>.models.splice(index, <span class="hljs-number">1</span>);
        <span class="hljs-built_in">this</span>.length--;</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>Remove references before triggering ‘remove’ event to prevent an
infinite loop. #3693</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">delete</span> <span class="hljs-built_in">this</span>._byId[model.cid];
        <span class="hljs-keyword">const</span> id = <span class="hljs-built_in">this</span>.modelId(model.attributes, model.idAttribute);
        <span class="hljs-keyword">if</span> (id != <span class="hljs-literal">null</span>) <span class="hljs-keyword">delete</span> <span class="hljs-built_in">this</span>._byId[id];

        <span class="hljs-keyword">if</span> (!options.silent) {
          options.index = index;
          model.trigger(<span class="hljs-string">&#x27;remove&#x27;</span>, model, <span class="hljs-built_in">this</span>, options);
        }

        removed.push(model);
        <span class="hljs-built_in">this</span>._removeReference(model, options);
      }
      <span class="hljs-keyword">return</span> removed;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Method for checking whether an object should be considered a model for
the purposes of adding to the collection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _isModel(model) {
      <span class="hljs-keyword">return</span> model <span class="hljs-keyword">instanceof</span> Model;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>Internal method to create a model’s ties to a collection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _addReference(model, options) {
      <span class="hljs-built_in">this</span>._byId[model.cid] = model;
      <span class="hljs-keyword">const</span> id = <span class="hljs-built_in">this</span>.modelId(model.attributes, model.idAttribute);
      <span class="hljs-keyword">if</span> (id != <span class="hljs-literal">null</span>) <span class="hljs-built_in">this</span>._byId[id] = model;
      model.on(<span class="hljs-string">&#x27;all&#x27;</span>, <span class="hljs-built_in">this</span>._onModelEvent, <span class="hljs-built_in">this</span>);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>Internal method to sever a model’s ties to a collection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _removeReference(model, options) {
      <span class="hljs-keyword">delete</span> <span class="hljs-built_in">this</span>._byId[model.cid];
      <span class="hljs-keyword">const</span> id = <span class="hljs-built_in">this</span>.modelId(model.attributes, model.idAttribute);
      <span class="hljs-keyword">if</span> (id != <span class="hljs-literal">null</span>) <span class="hljs-keyword">delete</span> <span class="hljs-built_in">this</span>._byId[id];
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span> === model.collection) <span class="hljs-keyword">delete</span> model.collection;
      model.off(<span class="hljs-string">&#x27;all&#x27;</span>, <span class="hljs-built_in">this</span>._onModelEvent, <span class="hljs-built_in">this</span>);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>Internal method called every time a model in the set fires an event.
Sets need to update their indexes when models change ids. All other
events simply proxy through. “add” and “remove” events that originate
in other collections are ignored.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _onModelEvent(event, model, collection, options) {
      <span class="hljs-keyword">if</span> (model) {
        <span class="hljs-keyword">if</span> ((event === <span class="hljs-string">&#x27;add&#x27;</span> || event === <span class="hljs-string">&#x27;remove&#x27;</span>) &amp;&amp; collection !== <span class="hljs-built_in">this</span>) <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">if</span> (event === <span class="hljs-string">&#x27;destroy&#x27;</span>) <span class="hljs-built_in">this</span>.remove(model, options);
        <span class="hljs-keyword">if</span> (event === <span class="hljs-string">&#x27;change&#x27;</span>) {
          <span class="hljs-keyword">const</span> prevId = <span class="hljs-built_in">this</span>.modelId(model.previousAttributes(), model.idAttribute);
          <span class="hljs-keyword">const</span> id = <span class="hljs-built_in">this</span>.modelId(model.attributes, model.idAttribute);
          <span class="hljs-keyword">if</span> (prevId !== id) {
            <span class="hljs-keyword">if</span> (prevId != <span class="hljs-literal">null</span>) <span class="hljs-keyword">delete</span> <span class="hljs-built_in">this</span>._byId[prevId];
            <span class="hljs-keyword">if</span> (id != <span class="hljs-literal">null</span>) <span class="hljs-built_in">this</span>._byId[id] = model;
          }
        }
      }
      <span class="hljs-built_in">this</span>.trigger.apply(<span class="hljs-built_in">this</span>, <span class="hljs-built_in">arguments</span>);
    }
  };

  <span class="hljs-keyword">const</span> proto = Collection.prototype;

  <span class="hljs-built_in">Object</span>.assign(proto, Events);</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>The default model for a collection is just a <strong>Model</strong>.
This should be overridden in most cases.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  proto.model = Model;</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>preinitialize is an empty function by default. You can override it with a function
or object.  preinitialize will run before any instantiation logic is run in the Collection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  proto.preinitialize = _.noop;</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>Initialize is an empty function by default. Override it with your own
initialization logic.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  proto.initialize = _.noop;

  <span class="hljs-keyword">if</span> ($$iterator) {
    proto[$$iterator] = proto.values;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>Lodash methods that we want to implement on the Collection. 90% of the core
usefulness of Backbone Collections is actually implemented right here:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  mixinMethods(
    Collection,
    [
      [<span class="hljs-string">&#x27;chain&#x27;</span>, _.chain, <span class="hljs-number">1</span>],
      [<span class="hljs-string">&#x27;countBy&#x27;</span>, _.countBy, <span class="hljs-number">3</span>],
      [<span class="hljs-string">&#x27;difference&#x27;</span>, _.difference, <span class="hljs-number">0</span>],
      [<span class="hljs-string">&#x27;drop&#x27;</span>, _.drop, <span class="hljs-number">3</span>],
      [<span class="hljs-string">&#x27;each&#x27;</span>, _.each, <span class="hljs-number">3</span>],
      [<span class="hljs-string">&#x27;every&#x27;</span>, _.every, <span class="hljs-number">3</span>],
      [<span class="hljs-string">&#x27;filter&#x27;</span>, _.filter, <span class="hljs-number">3</span>],
      [<span class="hljs-string">&#x27;find&#x27;</span>, _.find, <span class="hljs-number">3</span>],
      [<span class="hljs-string">&#x27;findIndex&#x27;</span>, _.findIndex, <span class="hljs-number">3</span>],
      [<span class="hljs-string">&#x27;findLastIndex&#x27;</span>, _.findLastIndex, <span class="hljs-number">3</span>],
      [<span class="hljs-string">&#x27;first&#x27;</span>, _.first, <span class="hljs-number">3</span>],
      [<span class="hljs-string">&#x27;forEach&#x27;</span>, _.forEach, <span class="hljs-number">3</span>],
      [<span class="hljs-string">&#x27;groupBy&#x27;</span>, _.groupBy, <span class="hljs-number">3</span>],
      [<span class="hljs-string">&#x27;head&#x27;</span>, _.head, <span class="hljs-number">3</span>],
      [<span class="hljs-string">&#x27;includes&#x27;</span>, _.includes, <span class="hljs-number">3</span>],
      [<span class="hljs-string">&#x27;indexOf&#x27;</span>, _.indexOf, <span class="hljs-number">3</span>],
      [<span class="hljs-string">&#x27;initial&#x27;</span>, _.initial, <span class="hljs-number">3</span>],
      [<span class="hljs-string">&#x27;invoke&#x27;</span>, _.invoke, <span class="hljs-number">0</span>],
      [<span class="hljs-string">&#x27;isEmpty&#x27;</span>, _.isEmpty, <span class="hljs-number">1</span>],
      [<span class="hljs-string">&#x27;keyBy&#x27;</span>, _.keyBy, <span class="hljs-number">3</span>],
      [<span class="hljs-string">&#x27;last&#x27;</span>, _.last, <span class="hljs-number">3</span>],
      [<span class="hljs-string">&#x27;lastIndexOf&#x27;</span>, _.lastIndexOf, <span class="hljs-number">3</span>],
      [<span class="hljs-string">&#x27;map&#x27;</span>, _.map, <span class="hljs-number">3</span>],
      [<span class="hljs-string">&#x27;max&#x27;</span>, _.max, <span class="hljs-number">3</span>],
      [<span class="hljs-string">&#x27;min&#x27;</span>, _.min, <span class="hljs-number">3</span>],
      [<span class="hljs-string">&#x27;partition&#x27;</span>, _.partition, <span class="hljs-number">3</span>],
      [<span class="hljs-string">&#x27;reduce&#x27;</span>, _.reduce, <span class="hljs-number">0</span>],
      [<span class="hljs-string">&#x27;reduceRight&#x27;</span>, _.reduceRight, <span class="hljs-number">0</span>],
      [<span class="hljs-string">&#x27;reject&#x27;</span>, _.reject, <span class="hljs-number">3</span>],
      [<span class="hljs-string">&#x27;sample&#x27;</span>, _.sample, <span class="hljs-number">3</span>],
      [<span class="hljs-string">&#x27;shuffle&#x27;</span>, _.shuffle, <span class="hljs-number">1</span>],
      [<span class="hljs-string">&#x27;size&#x27;</span>, _.size, <span class="hljs-number">1</span>],
      [<span class="hljs-string">&#x27;some&#x27;</span>, _.some, <span class="hljs-number">3</span>],
      [<span class="hljs-string">&#x27;sortBy&#x27;</span>, _.sortBy, <span class="hljs-number">3</span>],
      [<span class="hljs-string">&#x27;tail&#x27;</span>, _.tail, <span class="hljs-number">3</span>],
      [<span class="hljs-string">&#x27;take&#x27;</span>, _.take, <span class="hljs-number">3</span>],
      [<span class="hljs-string">&#x27;toArray&#x27;</span>, _.toArray, <span class="hljs-number">1</span>],
      [<span class="hljs-string">&#x27;without&#x27;</span>, _.without, <span class="hljs-number">0</span>],</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>Translated, roughly, from underscore:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      [<span class="hljs-string">&#x27;pairs&#x27;</span>, _.entries, <span class="hljs-number">1</span>],
    ],
    <span class="hljs-string">&#x27;models&#x27;</span>
  );</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>Translated, roughly, from underscore:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  proto.all = proto.every;
  proto.any = proto.some;
  proto.collect = proto.map;
  proto.contains = proto.include = proto.includes;
  proto.detect = proto.find;
  proto.foldl = proto.inject = proto.reduce;
  proto.foldr = proto.reduceRight;
  proto.indexBy = proto.keyBy;
  proto.rest = proto.tail;
  proto.select = proto.filter;

  <span class="hljs-keyword">return</span> Collection;
})();</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <h2 id="collectioniterator">CollectionIterator</h2>

            </div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>This “enum” defines the three possible kinds of values which can be emitted
by a CollectionIterator that correspond to the values(), keys() and entries()
methods on Collection, respectively.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> ITERATOR_VALUES = <span class="hljs-number">1</span>;
<span class="hljs-keyword">const</span> ITERATOR_KEYS = <span class="hljs-number">2</span>;
<span class="hljs-keyword">const</span> ITERATOR_KEYSVALUES = <span class="hljs-number">3</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>A CollectionIterator implements JavaScript’s Iterator protocol, allowing the
use of <code>for of</code> loops in modern browsers and interoperation between
Collection and other JavaScript functions and third-party libraries which can
operate on Iterables.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> CollectionIterator = <span class="hljs-comment">/*#__PURE__*/</span> (<span class="hljs-function">() =&gt;</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>eslint-disable-next-line no-shadow</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">const</span> CollectionIterator = <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CollectionIterator</span> </span>{
    _index = <span class="hljs-number">0</span>;

    <span class="hljs-keyword">constructor</span>(collection, kind) {
      <span class="hljs-built_in">this</span>._collection = collection;
      <span class="hljs-built_in">this</span>._kind = kind;
    }

    next() {
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>._collection) {</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>Only continue iterating if the iterated collection is long enough.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>._index &lt; <span class="hljs-built_in">this</span>._collection.length) {
          <span class="hljs-keyword">const</span> model = <span class="hljs-built_in">this</span>._collection.at(<span class="hljs-built_in">this</span>._index);
          <span class="hljs-built_in">this</span>._index++;</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>Construct a value depending on what kind of values should be iterated.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">let</span> value;
          <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>._kind === ITERATOR_VALUES) {
            value = model;
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">const</span> id = <span class="hljs-built_in">this</span>._collection.modelId(model.attributes);
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>._kind === ITERATOR_KEYS) {
              value = id;
            } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>ITERATOR_KEYSVALUES</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              value = [id, model];
            }
          }
          <span class="hljs-keyword">return</span> { <span class="hljs-attr">value</span>: value, <span class="hljs-attr">done</span>: <span class="hljs-literal">false</span> };
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>Once exhausted, remove the reference to the collection so future
calls to the next method always return done.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-built_in">this</span>._collection = <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;
      }

      <span class="hljs-keyword">return</span> { <span class="hljs-attr">value</span>: <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>, <span class="hljs-attr">done</span>: <span class="hljs-literal">true</span> };
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>All Iterators should themselves be Iterable.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">static</span> [$$iterator || <span class="hljs-string">&#x27;$$iterator&#x27;</span>]() {
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
    }
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>All Iterators should themselves be Iterable.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> ($$iterator) {
    CollectionIterator.prototype[$$iterator] = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
    };
  }

  <span class="hljs-keyword">return</span> CollectionIterator;
})();</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
